<script type="text/ng-template" id="typeahead.html">
    <a>
        <span ng-bind-html="match.label | uibTypeaheadHighlight:query"></span>
    </a>
</script>
<div class="page_header_container" ng-cloak>
    <div class="page_header">
        <div class="left page_action_container">

        </div>
        <div class="page_title">
            <h1>{$:: (inventory_type === 'taxlots' ? 'Tax Lots' : 'Properties') | translate $}</h1>
        </div>
        <div class="right page_action_container page_action_btn"></div>
    </div>
</div>

<div class="section_nav_container">
    <div class="section_nav" ng-include="::urls.static_url + 'seed/partials/inventory_nav.html'"></div>
</div>

<div class="modal-header">
    <h4 class="modal-title" ng-if="crud_selection == 'overview'"><i class="fa fa-calculator"></i> Data Aggregations</span></h4>
    <h4 class="modal-title" ng-if="crud_selection != 'overview'"><i class="fa fa-calculator"></i> {$ capitalize(crud_selection) $} <span translate>a Data Aggregation</span></h4>
    <button type="button" class="btn btn-info crud-option" ng-if="crud_selection == 'overview'" ng-click="crud_select('create')" autofocus>Create Data Aggreagtion</button>

</div>
<div class="white-space">
</div>

<div class="data-agg-detail section_content_container">
    <div ng-if="crud_selection == 'overview'" class="section_content with_padding data-agg-table-container">
        <div class="table_list_container has_borders">
            <table id="column-table" class="table has_no_btm_margin data-agg-table">
                <thead>
                    <tr>
                        <th class="text-left">
                            <span>Name</span>
                        </th>
                        <th class="text-left">
                            <span>Type</span>
                        </th>
                        <th class="text-left">
                            <span>Column ID / Name</span>
                        </th>
                        <th class="text-left">
                            <span>Value</span>
                        </th>
                        <th class="text-left">
                            <span>Units</span>
                        </th>
                        <th class="text-left">
                            <span>Actions</span>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-if="data_aggregations.length > 0" ng-repeat="data_aggregation in data_aggregations">
                        <td> 
                            {$ data_aggregation.name $}
                        </td>
                        <td>
                            {$ data_aggregation.type $}
                        </td>
                        <td>
                            {$ data_aggregation.column_id_name $}
                        </td>
                        <td>
                            {$ data_aggregation.value.value $}
                        </td>
                        <td>
                            {$ data_aggregation.value.units $}
                        </td>
                        <td class="text-center">
                            <button class="btn btn-info" type="button" ng-click="edit_data_aggregation(data_aggregation.id)">
                                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                            </button>
                            <button class="btn btn-danger" type="button" ng-click="confirm_delete_data_aggregation(data_aggregation.id)">
                                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>
    <div class="crud-detail detail-outline" ng-if="crud_selection == 'create' || crud_selection == 'update'">
        <div style="display: grid; gap:1rem;">
            Aggregation Name
            <div>
                <input
                    type="text"
                    ng-model="data_aggregation.name"
                    ng-change="validate_new_data_aggregation()"
                    class="form-control"
                    placeholder="Data Aggregation Name"
                >
            </div>
            Aggregation Type
            <select
                type="text"
                ng-model="data_aggregation.type"
                ng-options="option for option in data_aggregation_type_options"
                ng-change="validate_new_data_aggregation()"
                class="form-control">
            </select>
            Aggregation Source Column
            <div>
                <input
                    type="text"
                    ng-model="data_aggregation.column"
                    ng-blur="validate_new_data_aggregation()"
                    class="form-control"
                    placeholder="Source column name"
                    uib-typeahead="column as column.displayName for column in all_columns | filter:{displayName:$viewValue}"
                    typeahead-template-url="typeahead.html"
                    typeahead-editable="false"
                    typeahead-show-hint="true"
                    typeahead-min-length="0"
                    typeahead-select-on-exact="true"
                    typeahead-select-on-blur="true"
                    autocomplete="off"
                    autocorrect="off"
                    autocapitalize="off"
                    spellcheck="false"
                    aria-label="Source column name"
                >
            </div>
        </div>
    </div>
    <!-- <div class="crud-detail" ng-if="crud_selection == 'update'">
        UPDATE INFO
    </div> -->
    <div class="crud-detail" ng-if="crud_selection == 'delete'">
        Are you sure you would like to delete Data Aggregation '{$ data_aggregation_to_delete.name$}'

    </div>

    <div class="crud-detail" ng-if="crud_selection == 'post_action'">
        {$ message $}
    </div>
</div>

<div class="modal-footer">
    <button type="button" class="btn btn-default" ng-click="cancel()" >Close</button>
    <button type="button" class="btn btn-default" ng-if="crud_selection != 'overview'" ng-click="crud_select('overview')" autofocus>Back</button>
    <button type="button" class="btn btn-info" ng-if="crud_selection == 'create'" ng-disabled="!validate_data_aggregation()" ng-click="create_data_aggregation()" autofocus>Create</button>
    <button type="button" class="btn btn-info" ng-if="crud_selection == 'update'" ng-click="update_data_aggregation(data_aggregation.id)" autofocus>Update</button>
    <button type="button" class="btn btn-info" ng-if="crud_selection == 'delete'" ng-click="delete_data_aggregation(data_aggregation_to_delete.id)" autofocus>Delete</button>
</div>
